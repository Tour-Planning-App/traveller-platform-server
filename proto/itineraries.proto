syntax = "proto3";

package itineraries;

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";
option go_package = "github.com/Tour-Planning-App/traveller-platform-server/proto/trip";

message Trip {
  string id = 1;
  string user_id = 2;
  string name = 3;
  string destination = 4;
  repeated string dates = 5; // ISO strings, e.g., ['2025-12-01', '2025-12-07']
  double budget = 6; // In user's currency
  repeated ItineraryDay itinerary = 7;
  repeated BucketItem bucket_list = 8;
  bool is_shared = 9;
  string share_token = 10; // For sharing
  google.protobuf.Timestamp created_at = 11;
  google.protobuf.Timestamp updated_at = 12;
}

message ItineraryDay {
  int32 day = 1; // Day number (1-based)
  string date = 2; // ISO date
  string name = 3; // e.g., 'Day 1: Arrival in Colombo'
  repeated Activity activities = 4;
  repeated Note notes = 5;
  repeated ChecklistItem checklist = 6;
}

message Activity {
  string id = 1;
  string type = 2; // 'place', 'stay', 'food', 'activity'
  string name = 3;
  string description = 4;
  double rating = 5;
  string location = 6; // e.g., 'Colombo, Sri Lanka'
  google.protobuf.Timestamp time = 7; // Start time
  repeated Note notes = 8;
  repeated Checklist checklists = 9;
}

message BucketItem {
  string id = 1;
  string name = 2;
  string description = 3;
  bool confirmed = 4; // Added to itinerary or not
}

message NoteList {
  repeated Note notes = 1;
}

message Note {
  string title = 1;
  string content = 2;
  google.protobuf.Timestamp createdAt = 3;
}

message Checklist {
  string id = 1;
  string title = 2;
  repeated ChecklistItem items = 3;
}

message ChecklistItem {
  string id = 1;
  string text = 2;
  bool completed = 3;
}

message CreateTripRequest {
  string user_id = 1;
  string name = 2;
  string destination = 3;
  repeated string dates = 4;
  double budget = 5;
}

message CreateTripResponse {
  bool success = 1;
  string message = 2;
  Trip trip = 3;
}

message UpdateTripRequest {
  string id = 1;
  string userId = 2;
  string name = 3;
  repeated string dates = 4; // For edit dates
  double budget = 5; // For edit budget
}

message UpdateTripResponse {
  bool success = 1;
  string message = 2;
  Trip trip = 3;
}

message GetTripRequest {
  string id = 1;
}

message GetTripResponse {
  bool success = 1;
  Trip trip = 2;
}

message GetUserTripsRequest {
  string user_id = 1;
}

message GetUserTripsResponse {
  bool success = 1;
  repeated Trip trips = 2;
}

message DeleteTripRequest {
  string id = 1;
  string userId =2;
}

message DeleteTripResponse {
  bool success = 1;
  string message = 2;
}

message AddItineraryItemRequest {
  string tripId = 1;
  string userId =2;
  int32 day = 3;
  Activity activity = 4; // Add place/stay/food/activity
}

message AddItineraryItemResponse {
  bool success = 1;
  string message = 2;
  ItineraryDay day = 3;
}

message RemoveItineraryItemRequest {
  string tripId = 1;
  string userId =2;
  string activityId = 3;
  int32 day = 4;
}

message RemoveItineraryItemResponse {
  bool success = 1;
  string message = 2;
}

message AddBucketItemRequest {
  string tripId = 1;
  string userId =2;
  string name = 3;
  string description = 4;
  string photoUrl = 5;
  string address = 6;
}

message AddBucketItemResponse {
  bool success = 1;
  string message = 2;
  BucketItem item = 3;
}

message RemoveBucketItemRequest {
  string tripId = 1;
  string userId =2;
  string itemId = 3;
}

message RemoveBucketItemResponse {
  bool success = 1;
  string message = 2;
}

message ShareTripRequest {
  string tripId = 1;
  string userId =2;
}

message ShareTripResponse {
  bool success = 1;
  string message = 2;
  string share_token = 3;
}

message AddNoteRequest {
  string tripId = 1;
  string userId = 2;
  string activityId = 3;
  string title = 4;
  string content = 5;
}

message AddNoteResponse {
  bool success = 1;
  string message = 2;
  Note note = 3;
}

message AddChecklistItemRequest {
  string tripId = 1;
  string userId = 2;
  string activityId = 3;
  string title = 4;
  repeated string texts = 5;
}

message AddChecklistItemResponse {
  bool success = 1;
  string message = 2;
  Checklist checklist = 3;
}

message UpdateChecklistItemRequest {
  string tripId = 1;
  string userId = 2;
  string activityId = 3;
  string checklistTitle = 4; // To identify which checklist
  string itemId = 5;
  bool completed = 6;
}

message UpdateChecklistItemResponse {
  bool success = 1;
  string message = 2;
}

message OptimizeDayRequest{
  string tripId = 1;
  string userId =2;
  int32 day = 3;
}

message OptimizeDayResponse{
  bool success = 1;
  string message = 2;
  google.protobuf.Struct day = 3;
}

message MoveBucketToItineraryRequest{
  string tripId = 1;
  string userId =2;
  string itemId =3;
  int32 day = 4;
  string activityType =5;
}

message MoveBucketToItineraryResponse{
  bool success = 1;
  string message = 2;
  Activity activity = 3;
}

message AutoFillLocationRequest{
  string tripId = 1;
  string userId =2;
  int32 day = 3;
  string activityId =4;
  string query = 5;
}

message AutoFillLocationResponse{
  bool success = 1;
  string message = 2;
  google.protobuf.Struct location = 3;
}

message SearchLocationsRequest{
  string tripId = 1;
  string userId =2;
  SearchLocations searchLocations =3;
}

message SearchLocationsResponse{
  bool success = 1;
  string message = 2;
  google.protobuf.Struct suggestions = 3;
}

message SearchLocations {
 string query = 1;
 int32 limit = 2;
}

service ItinerariesService {
  rpc CreateTrip(CreateTripRequest) returns (CreateTripResponse);
  rpc UpdateTrip(UpdateTripRequest) returns (UpdateTripResponse);
  rpc GetTrip(GetTripRequest) returns (GetTripResponse);
  rpc GetUserTrips(GetUserTripsRequest) returns (GetUserTripsResponse);
  rpc DeleteTrip(DeleteTripRequest) returns (DeleteTripResponse);
  rpc AddItineraryItem(AddItineraryItemRequest) returns (AddItineraryItemResponse);
  rpc RemoveItineraryItem(RemoveItineraryItemRequest) returns (RemoveItineraryItemResponse);
  rpc AddBucketItem(AddBucketItemRequest) returns (AddBucketItemResponse);
  rpc RemoveBucketItem(RemoveBucketItemRequest) returns (RemoveBucketItemResponse);
  rpc ShareTrip(ShareTripRequest) returns (ShareTripResponse);
  rpc AddNote(AddNoteRequest) returns (AddNoteResponse);
  rpc AddChecklistItem(AddChecklistItemRequest) returns (AddChecklistItemResponse);
  rpc UpdateChecklistItem(UpdateChecklistItemRequest) returns (UpdateChecklistItemResponse);
  rpc OptimizeDay(OptimizeDayRequest) returns (OptimizeDayResponse);
  rpc MoveBucketToItinerary(MoveBucketToItineraryRequest) returns (MoveBucketToItineraryResponse);
  rpc AutoFillLocation(AutoFillLocationRequest) returns (AutoFillLocationResponse);
  rpc SearchLocations(SearchLocationsRequest) returns (SearchLocationsResponse);

}